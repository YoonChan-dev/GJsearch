<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¡°ë¡€ê²€ìƒ‰</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #FAFAF9;
    --surface: #FFFFFF;
    --border: #E8E5E0;
    --text-primary: #1A1A1A;
    --text-secondary: #6B6560;
    --text-muted: #9C9690;
    --accent: #2C5F2D;
    --accent-light: #EDF4ED;
    --accent-hover: #1E4620;
    --danger: #C44536;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
    --shadow-lg: 0 8px 30px rgba(0,0,0,0.08);
    --radius: 10px;
    --font: 'Pretendard', 'Noto Sans KR', -apple-system, sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font);
    background: var(--bg);
    color: var(--text-primary);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  /* Header */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
    background: rgba(255,255,255,0.92);
  }

  .header-inner {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo-icon {
    width: 32px;
    height: 32px;
    background: var(--accent);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    font-weight: 700;
  }

  .logo-text {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.5px;
    color: var(--text-primary);
  }

  .logo-sub {
    font-size: 11px;
    color: var(--text-muted);
    font-weight: 400;
    letter-spacing: 0.5px;
  }

  .header-badge {
    font-size: 11px;
    color: var(--accent);
    background: var(--accent-light);
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 500;
  }

  /* Main */
  main {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 24px;
  }

  /* Search Section */
  .search-section {
    padding: 48px 0 32px;
  }

  .search-title {
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -1px;
    margin-bottom: 6px;
    color: var(--text-primary);
  }

  .search-desc {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 28px;
    line-height: 1.5;
  }

  .search-box {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }

  .search-input-wrap {
    flex: 1;
    position: relative;
  }

  .search-input-wrap svg {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    width: 18px;
    height: 18px;
    pointer-events: none;
  }

  .search-input {
    width: 100%;
    height: 52px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 0 16px 0 44px;
    font-size: 15px;
    font-family: var(--font);
    background: var(--surface);
    color: var(--text-primary);
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }

  .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(44,95,45,0.1);
  }

  .search-input::placeholder {
    color: var(--text-muted);
  }

  .search-btn {
    height: 52px;
    padding: 0 28px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 600;
    font-family: var(--font);
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    white-space: nowrap;
  }

  .search-btn:hover { background: var(--accent-hover); }
  .search-btn:active { transform: scale(0.98); }
  .search-btn:disabled { opacity: 0.6; cursor: not-allowed; }

  /* API Key Section */
  .api-key-section {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }

  .api-key-input {
    height: 40px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 0 12px;
    font-size: 13px;
    font-family: var(--font);
    background: var(--surface);
    color: var(--text-primary);
    width: 240px;
    outline: none;
    transition: border-color 0.2s;
  }

  .api-key-input:focus {
    border-color: var(--accent);
  }

  .api-key-label {
    font-size: 12px;
    color: var(--text-muted);
  }

  .api-key-help {
    font-size: 11px;
    color: var(--accent);
    text-decoration: none;
    margin-left: auto;
  }

  .api-key-help:hover { text-decoration: underline; }

  /* Filters */
  .filters {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
  }

  .filter-select {
    height: 36px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 0 32px 0 12px;
    font-size: 13px;
    font-family: var(--font);
    background: var(--surface);
    color: var(--text-secondary);
    cursor: pointer;
    outline: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%239C9690' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    transition: border-color 0.2s;
  }

  .filter-select:focus { border-color: var(--accent); }

  .filter-count {
    font-size: 12px;
    color: var(--text-muted);
    margin-left: auto;
  }

  /* Results */
  .results-section {
    padding-bottom: 60px;
  }

  .result-status {
    padding: 12px 0 20px;
    font-size: 13px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .result-status strong {
    color: var(--accent);
    font-weight: 600;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-muted);
  }

  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.4;
  }

  .empty-title {
    font-size: 16px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 6px;
  }

  .empty-desc {
    font-size: 13px;
    line-height: 1.6;
  }

  /* Result Card */
  .result-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px 24px;
    margin-bottom: 10px;
    transition: box-shadow 0.2s, border-color 0.2s;
    cursor: pointer;
    animation: fadeUp 0.3s ease both;
  }

  .result-card:hover {
    box-shadow: var(--shadow-md);
    border-color: #D0CDC8;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-card-header {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 8px;
  }

  .result-type {
    font-size: 11px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 4px;
    white-space: nowrap;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .type-ì¡°ë¡€ { background: #E8F0FE; color: #1A56DB; }
  .type-ê·œì¹™ { background: #FEF3C7; color: #B45309; }
  .type-í›ˆë ¹ { background: #F0FDF4; color: #16A34A; }
  .type-ì˜ˆê·œ { background: #FDF2F8; color: #DB2777; }
  .type-ê¸°íƒ€ { background: #F3F4F6; color: #6B7280; }

  .result-name {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.45;
    letter-spacing: -0.3px;
  }

  .result-meta {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .result-meta-item {
    font-size: 12px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .result-meta-item strong {
    color: var(--text-secondary);
    font-weight: 500;
  }

  /* Loading */
  .loading {
    display: flex;
    justify-content: center;
    padding: 60px 0;
  }

  .spinner {
    width: 28px;
    height: 28px;
    border: 2.5px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    gap: 4px;
    padding: 24px 0;
  }

  .page-btn {
    min-width: 36px;
    height: 36px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
    color: var(--text-secondary);
    font-size: 13px;
    font-family: var(--font);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }

  .page-btn:hover { border-color: var(--accent); color: var(--accent); }
  .page-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
    font-weight: 600;
  }

  /* Error */
  .error-msg {
    background: #FEF2F2;
    border: 1px solid #FECACA;
    border-radius: var(--radius);
    padding: 16px 20px;
    color: var(--danger);
    font-size: 13px;
    line-height: 1.5;
    margin-bottom: 16px;
  }

  /* Detail Modal */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 1000;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.2s ease;
  }

  .modal-overlay.active { display: flex; align-items: center; justify-content: center; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .modal {
    background: var(--surface);
    border-radius: 14px;
    width: 90%;
    max-width: 720px;
    max-height: 85vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow-lg);
    animation: slideUp 0.25s ease;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
  }

  .modal-title {
    font-size: 17px;
    font-weight: 700;
    line-height: 1.4;
    letter-spacing: -0.3px;
  }

  .modal-close {
    width: 32px;
    height: 32px;
    border: none;
    background: var(--bg);
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: var(--text-muted);
    flex-shrink: 0;
    transition: background 0.15s;
  }

  .modal-close:hover { background: var(--border); }

  .modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
  }

  .modal-meta {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .modal-meta-tag {
    font-size: 12px;
    padding: 4px 10px;
    background: var(--bg);
    border-radius: 6px;
    color: var(--text-secondary);
  }

  .modal-content {
    font-size: 14px;
    line-height: 1.8;
    color: var(--text-primary);
    white-space: pre-wrap;
    word-break: keep-all;
  }

  .modal-content .jo-title {
    font-weight: 600;
    color: var(--accent);
    margin-top: 16px;
    margin-bottom: 4px;
  }

  .modal-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 60px 0;
    flex-direction: column;
    gap: 12px;
    color: var(--text-muted);
    font-size: 13px;
  }

  .modal-link {
    display: inline-block;
    margin-top: 16px;
    font-size: 13px;
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
  }

  .modal-link:hover { text-decoration: underline; }

  /* Footer */
  footer {
    max-width: 900px;
    margin: 0 auto;
    padding: 24px;
    text-align: center;
    font-size: 11px;
    color: var(--text-muted);
    border-top: 1px solid var(--border);
  }

  footer a { color: var(--text-secondary); text-decoration: none; }
  footer a:hover { text-decoration: underline; }

  /* Responsive */
  @media (max-width: 600px) {
    .search-box { flex-direction: column; }
    .search-btn { width: 100%; }
    .search-title { font-size: 22px; }
    .api-key-section { flex-wrap: wrap; }
    .api-key-input { width: 100%; }
    .result-card { padding: 16px; }
    .modal { width: 95%; max-height: 90vh; }
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">æ³•</div>
      <div>
        <div class="logo-text">ì¡°ë¡€ê²€ìƒ‰</div>
        <div class="logo-sub">ì „êµ­ ìì¹˜ë²•ê·œ í†µí•©ê²€ìƒ‰</div>
      </div>
    </div>
    <span class="header-badge">ë²•ì œì²˜ OPEN API</span>
  </div>
</header>

<main>
  <section class="search-section">
    <h1 class="search-title">ì „êµ­ ì¡°ë¡€ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”</h1>
    <p class="search-desc">ë²•ì œì²˜ êµ­ê°€ë²•ë ¹ì •ë³´ ê³µë™í™œìš© APIë¥¼ í†µí•´ ì „êµ­ ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì¡°ë¡€Â·ê·œì¹™ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>

    <div class="api-key-section">
      <span class="api-key-label">API ì¸ì¦í‚¤ (OC)</span>
      <input type="text" id="apiKey" class="api-key-input" placeholder="open.law.go.krì—ì„œ ë°œê¸‰ë°›ì€ OC" value="test">
      <a href="https://open.law.go.kr" target="_blank" class="api-key-help">ì¸ì¦í‚¤ ë°œê¸‰ â†’</a>
    </div>

    <div class="search-box">
      <div class="search-input-wrap">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
        <input type="text" id="searchInput" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì£¼ì°¨ì¥, ë„ì‹œê³µì›, ê°œì¸ì •ë³´ë³´í˜¸)" autofocus>
      </div>
      <button id="searchBtn" class="search-btn" onclick="search()">ê²€ìƒ‰</button>
    </div>

    <div class="filters">
      <select id="filterSort" class="filter-select" onchange="search()">
        <option value="">ì •ë ¬: ê¸°ë³¸</option>
        <option value="date">ê³µí¬ì¼ìˆœ</option>
        <option value="name">ë²•ê·œëª…ìˆœ</option>
      </select>
      <select id="filterType" class="filter-select" onchange="search()">
        <option value="">ìœ í˜•: ì „ì²´</option>
        <option value="ì¡°ë¡€">ì¡°ë¡€</option>
        <option value="ê·œì¹™">ê·œì¹™</option>
      </select>
      <span id="resultCount" class="filter-count"></span>
    </div>
  </section>

  <section class="results-section">
    <div id="error"></div>
    <div id="results">
      <div class="empty-state">
        <div class="empty-icon">âš–</div>
        <div class="empty-title">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
        <div class="empty-desc">ì „êµ­ ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì¡°ë¡€ì™€ ê·œì¹™ì„<br>í‚¤ì›Œë“œë¡œ í†µí•© ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </div>
    </div>
    <div id="pagination" class="pagination"></div>
  </section>
</main>

<!-- Detail Modal -->
<div id="modalOverlay" class="modal-overlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modalBody">
    </div>
  </div>
</div>

<footer>
  ë³¸ ì„œë¹„ìŠ¤ëŠ” <a href="https://open.law.go.kr" target="_blank">ë²•ì œì²˜ êµ­ê°€ë²•ë ¹ì •ë³´ ê³µë™í™œìš©</a> OPEN APIë¥¼ í™œìš©í•©ë‹ˆë‹¤.
  ë°ì´í„°ì˜ ì •í™•ì„±ì€ ë²•ì œì²˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.
</footer>

<script>
  // â”€â”€ State â”€â”€
  let currentPage = 1;
  let currentQuery = '';
  let totalCount = 0;
  const DISPLAY = 20;

  // â”€â”€ Elements â”€â”€
  const $ = id => document.getElementById(id);
  const searchInput = $('searchInput');
  const resultsDiv = $('results');
  const paginationDiv = $('pagination');
  const errorDiv = $('error');
  const resultCountSpan = $('resultCount');

  // Enter key
  searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') search(); });

  // â”€â”€ API Helper â”€â”€
  function getApiUrl(query, page) {
    const oc = $('apiKey').value.trim() || 'test';
    const sort = $('filterSort').value;
    let url = `http://www.law.go.kr/DRF/lawSearch.do?OC=${encodeURIComponent(oc)}&target=ordin&type=XML&query=${encodeURIComponent(query)}&display=${DISPLAY}&page=${page}`;
    if (sort === 'date') url += '&sort=date';
    if (sort === 'name') url += '&sort=lasc';
    return url;
  }

  function getDetailUrl(mst) {
    const oc = $('apiKey').value.trim() || 'test';
    return `http://www.law.go.kr/DRF/lawService.do?OC=${encodeURIComponent(oc)}&target=ordin&type=XML&MST=${encodeURIComponent(mst)}`;
  }

  // â”€â”€ Fetch with CORS proxy fallback â”€â”€
  async function fetchXml(url) {
    // ì§ì ‘ ìš”ì²­ ì‹œë„
    try {
      const res = await fetch(url);
      if (res.ok) {
        const text = await res.text();
        const parser = new DOMParser();
        return parser.parseFromString(text, 'text/xml');
      }
    } catch (e) {
      // CORS ì—ëŸ¬ ì‹œ í”„ë¡ì‹œ ì‹œë„
    }

    // CORS proxy fallback
    const proxyUrls = [
      `https://corsproxy.io/?${encodeURIComponent(url)}`,
      `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`
    ];

    for (const proxy of proxyUrls) {
      try {
        const res = await fetch(proxy);
        if (res.ok) {
          const text = await res.text();
          const parser = new DOMParser();
          return parser.parseFromString(text, 'text/xml');
        }
      } catch (e) {
        continue;
      }
    }

    throw new Error('API ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. CORS ì œí•œìœ¼ë¡œ ì¸í•´ ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” í”„ë¡ì‹œ ì„œë²„ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }

  // â”€â”€ Search â”€â”€
  async function search(page = 1) {
    const query = searchInput.value.trim();
    if (!query) {
      searchInput.focus();
      return;
    }

    currentQuery = query;
    currentPage = page;
    errorDiv.innerHTML = '';
    resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
    paginationDiv.innerHTML = '';
    resultCountSpan.textContent = '';

    try {
      const url = getApiUrl(query, page);
      const xml = await fetchXml(url);

      // Check for error
      const parseError = xml.querySelector('parsererror');
      if (parseError) throw new Error('API ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

      totalCount = parseInt(xml.querySelector('totalCnt')?.textContent || '0');
      const items = xml.querySelectorAll('ordin') || [];
      const filterType = $('filterType').value;

      resultCountSpan.textContent = `ì´ ${totalCount.toLocaleString()}ê±´`;

      if (totalCount === 0 || items.length === 0) {
        resultsDiv.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ”</div>
            <div class="empty-title">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <div class="empty-desc">"${escHtml(query)}"ì— ëŒ€í•œ ìì¹˜ë²•ê·œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.<br>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</div>
          </div>`;
        return;
      }

      let html = '';
      let visibleCount = 0;

      items.forEach((item, i) => {
        const name = getText(item, 'ìì¹˜ë²•ê·œëª…') || getText(item, 'ordinNm') || '';
        const localGov = getText(item, 'ìì¹˜ë‹¨ì²´ëª…') || getText(item, 'localGovNm') || '';
        const ordinType = getText(item, 'ìì¹˜ë²•ê·œì¢…ë¥˜') || getText(item, 'ordinType') || '';
        const promDate = getText(item, 'ê³µí¬ì¼ì') || getText(item, 'promDt') || '';
        const enfDate = getText(item, 'ì‹œí–‰ì¼ì') || getText(item, 'enfDt') || '';
        const mst = getText(item, 'ìì¹˜ë²•ê·œID') || getText(item, 'ordinId') || item.querySelector('ìì¹˜ë²•ê·œìƒì„¸ë§í¬,ordinDetailLink')?.textContent || '';

        // Client-side type filter
        if (filterType && !ordinType.includes(filterType)) return;
        visibleCount++;

        const typeClass = ordinType.includes('ì¡°ë¡€') ? 'ì¡°ë¡€' :
                          ordinType.includes('ê·œì¹™') ? 'ê·œì¹™' :
                          ordinType.includes('í›ˆë ¹') ? 'í›ˆë ¹' :
                          ordinType.includes('ì˜ˆê·œ') ? 'ì˜ˆê·œ' : 'ê¸°íƒ€';

        const formattedDate = formatDate(promDate || enfDate);

        html += `
          <div class="result-card" style="animation-delay:${i * 0.03}s" onclick="showDetail('${escAttr(mst)}', '${escAttr(name)}')">
            <div class="result-card-header">
              <span class="result-type type-${typeClass}">${escHtml(ordinType || 'ìì¹˜ë²•ê·œ')}</span>
              <span class="result-name">${escHtml(name)}</span>
            </div>
            <div class="result-meta">
              ${localGov ? `<span class="result-meta-item">ğŸ“ <strong>${escHtml(localGov)}</strong></span>` : ''}
              ${formattedDate ? `<span class="result-meta-item">ğŸ“… ${formattedDate}</span>` : ''}
            </div>
          </div>`;
      });

      if (visibleCount === 0 && filterType) {
        resultsDiv.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-title">í•„í„° ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <div class="empty-desc">í˜„ì¬ í˜ì´ì§€ì—ì„œ "${filterType}" ìœ í˜•ì˜ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.<br>í•„í„°ë¥¼ í•´ì œí•˜ê±°ë‚˜ ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</div>
          </div>`;
      } else {
        resultsDiv.innerHTML = html;
      }

      renderPagination();

    } catch (err) {
      resultsDiv.innerHTML = '';
      errorDiv.innerHTML = `<div class="error-msg">âš ï¸ ${escHtml(err.message)}<br><br>
        <strong>í•´ê²° ë°©ë²•:</strong><br>
        1. <a href="https://open.law.go.kr" target="_blank">open.law.go.kr</a>ì—ì„œ OC(ì¸ì¦í‚¤)ë¥¼ ë°œê¸‰ë°›ì•„ ì…ë ¥í•˜ì„¸ìš”.<br>
        2. ë¡œì»¬ íŒŒì¼ë¡œ ì—´ ê²½ìš° CORS ì œí•œì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ ì›¹ì„œë²„ë¡œ ì‹¤í–‰í•˜ê±°ë‚˜, API ì¸ì¦í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
      </div>`;
    }
  }

  // â”€â”€ Detail Modal â”€â”€
  async function showDetail(mst, name) {
    const overlay = $('modalOverlay');
    const body = $('modalBody');
    const title = $('modalTitle');

    title.textContent = name;
    body.innerHTML = '<div class="modal-loading"><div class="spinner"></div><span>ë³¸ë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></div>';
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';

    try {
      // mstê°€ URLì¸ ê²½ìš° ì§ì ‘ ì‚¬ìš©, ì•„ë‹ˆë©´ IDë¡œ ì¡°íšŒ
      let url;
      if (mst.startsWith('http')) {
        url = mst.replace('HTML', 'XML').replace('html', 'XML');
        if (!url.includes('type=XML')) {
          url = getDetailUrl(mst);
        }
      } else {
        url = getDetailUrl(mst);
      }

      const xml = await fetchXml(url);

      // ì¡°ë¬¸ íŒŒì‹±
      const articles = xml.querySelectorAll('ì¡°ë¬¸,article,jo');
      let content = '';

      if (articles.length > 0) {
        articles.forEach(art => {
          const joNo = art.querySelector('ì¡°ë¬¸ë²ˆí˜¸,joNo,ì¡°ë²ˆí˜¸')?.textContent || '';
          const joTitle = art.querySelector('ì¡°ë¬¸ì œëª©,joTitl')?.textContent || '';
          const joContent = art.querySelector('ì¡°ë¬¸ë‚´ìš©,joContent,ì¡°ë¬¸')?.textContent || '';

          if (joNo || joTitle || joContent) {
            content += `<div class="jo-title">${escHtml(joNo)} ${escHtml(joTitle)}</div>`;
            content += `<div>${escHtml(joContent)}</div>\n`;
          }

          // í•­
          const hangs = art.querySelectorAll('í•­,hang');
          hangs.forEach(hang => {
            const hangContent = hang.querySelector('í•­ë‚´ìš©,hangContent')?.textContent || hang.textContent || '';
            if (hangContent) content += `<div style="margin-left:16px">${escHtml(hangContent)}</div>\n`;
          });
        });
      }

      if (!content) {
        // Fallback: ì „ì²´ í…ìŠ¤íŠ¸
        const allText = xml.documentElement?.textContent?.trim() || '';
        content = allText ? `<div>${escHtml(allText.substring(0, 5000))}</div>` : '<div style="color:var(--text-muted)">ë³¸ë¬¸ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
      }

      // ë©”íƒ€ ì •ë³´
      const localGov = xml.querySelector('ìì¹˜ë‹¨ì²´ëª…,localGovNm')?.textContent || '';
      const ordinType = xml.querySelector('ìì¹˜ë²•ê·œì¢…ë¥˜,ordinType')?.textContent || '';
      const promDate = xml.querySelector('ê³µí¬ì¼ì,promDt')?.textContent || '';

      let metaHtml = '<div class="modal-meta">';
      if (localGov) metaHtml += `<span class="modal-meta-tag">ğŸ“ ${escHtml(localGov)}</span>`;
      if (ordinType) metaHtml += `<span class="modal-meta-tag">${escHtml(ordinType)}</span>`;
      if (promDate) metaHtml += `<span class="modal-meta-tag">ğŸ“… ${formatDate(promDate)}</span>`;
      metaHtml += '</div>';

      const lawLink = `https://www.law.go.kr/ìì¹˜ë²•ê·œ/${encodeURIComponent(name)}`;

      body.innerHTML = `
        ${metaHtml}
        <div class="modal-content">${content}</div>
        <a href="${lawLink}" target="_blank" class="modal-link">ğŸ”— êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°ì—ì„œ ì›ë¬¸ ë³´ê¸° â†’</a>
      `;

    } catch (err) {
      body.innerHTML = `
        <div style="text-align:center;padding:40px;color:var(--text-muted)">
          <p>ë³¸ë¬¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
          <p style="font-size:12px;margin-top:8px">${escHtml(err.message)}</p>
          <a href="https://www.law.go.kr/ìì¹˜ë²•ê·œ/${encodeURIComponent(name)}" target="_blank" class="modal-link">ğŸ”— êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°ì—ì„œ ì§ì ‘ í™•ì¸ â†’</a>
        </div>`;
    }
  }

  function closeModal(e) {
    if (e && e.target !== $('modalOverlay')) return;
    $('modalOverlay').classList.remove('active');
    document.body.style.overflow = '';
  }

  // ESC key
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

  // â”€â”€ Pagination â”€â”€
  function renderPagination() {
    const totalPages = Math.ceil(totalCount / DISPLAY);
    if (totalPages <= 1) { paginationDiv.innerHTML = ''; return; }

    const maxVisible = 7;
    let start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
    let end = Math.min(totalPages, start + maxVisible - 1);
    if (end - start + 1 < maxVisible) start = Math.max(1, end - maxVisible + 1);

    let html = '';

    if (currentPage > 1) {
      html += `<button class="page-btn" onclick="search(${currentPage - 1})">â€¹</button>`;
    }

    if (start > 1) {
      html += `<button class="page-btn" onclick="search(1)">1</button>`;
      if (start > 2) html += `<button class="page-btn" disabled>â€¦</button>`;
    }

    for (let i = start; i <= end; i++) {
      html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="search(${i})">${i}</button>`;
    }

    if (end < totalPages) {
      if (end < totalPages - 1) html += `<button class="page-btn" disabled>â€¦</button>`;
      html += `<button class="page-btn" onclick="search(${totalPages})">${totalPages}</button>`;
    }

    if (currentPage < totalPages) {
      html += `<button class="page-btn" onclick="search(${currentPage + 1})">â€º</button>`;
    }

    paginationDiv.innerHTML = html;
  }

  // â”€â”€ Utility â”€â”€
  function getText(el, ...tags) {
    for (const tag of tags) {
      const found = el.querySelector(tag);
      if (found?.textContent?.trim()) return found.textContent.trim();
    }
    return '';
  }

  function formatDate(d) {
    if (!d || d.length < 8) return d;
    const clean = d.replace(/[^0-9]/g, '');
    if (clean.length >= 8) return `${clean.slice(0,4)}.${clean.slice(4,6)}.${clean.slice(6,8)}`;
    return d;
  }

  function escHtml(s) {
    const div = document.createElement('div');
    div.textContent = s;
    return div.innerHTML;
  }

  function escAttr(s) {
    return s.replace(/'/g, "\\'").replace(/"/g, '&quot;');
  }
</script>

</body>
</html>
